!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).Cyre={})}(this,function(t){"use strict";var e={insert:function(t,e){var i={};for(var n in t.id=t.id||null,t.type=t.type||null,t){if(i[n]=e[n]?e[n](t[n]):{ok:!1,data:null,message:"'"+n+"' data definition not found",required:!1},!i[n].ok&&i[n].required)return console.log("middleware error"),{ok:!1,data:i,message:i[n].message};i[n].ok||console.error(i[n].message),i[n]=i[n].data}return{ok:!0,data:i}},update:function(t,e){var i={};for(var n in t)i[n]=!!e[n]&&e[n](t[n]),i[n].ok||console.error(i[n].message),i[n]=i[n].data;return{ok:!0,data:i}}},i={id:function(t){return void 0===t&&(t=0),"string"!=typeof t?{ok:!1,data:null,message:"action.id must be a string. Received '"+t+"'",required:!0}:{ok:!0,data:t,required:!0}},type:function(t){return void 0===t&&(t=""),"string"==typeof t?{ok:!0,data:t}:{ok:!1,data:null,message:"action.type must be a string. Received '"+t+"'",required:!0}},payload:function(t){return void 0===t&&(t=null),{ok:!0,data:t}},interval:function(t){return void 0===t&&(t=0),Number.isInteger(t)?{ok:!0,data:t}:{ok:!1,data:0,message:"'"+t+"' invalid action.interval value"}},repeat:function(t){return void 0===t&&(t=0),Number.isInteger(t)?{ok:!0,data:t}:{ok:!1,data:0,message:"'"+t+"' invalid action.repeat value"}},group:function(t){return void 0===t&&(t=""),"string"==typeof t?{ok:!0,data:t}:{ok:!1,data:null,message:"'"+t+"' invalid action.group value"}},callback:function(t){return void 0===t&&(t=""),"string"==typeof t?{ok:!0,data:t}:{ok:!1,data:null,message:"'"+t+"' invalid action.callback value"}},log:function(t){return void 0===t&&(t=!1),"boolean"==typeof t?{ok:!0,data:t}:{ok:!1,data:!1,message:"'"+t+"' invalid action.log value"}},middleware:function(t){return void 0===t&&(t=null),"string"==typeof t?{ok:!0,data:t}:{ok:!1,data:null,message:"'"+t+"' invalid action.middleware value"}},at:function(t){return void 0===t&&(t=0),{ok:!1,data:t,message:"'"+t+"'  action.at is an experimental feature, not applied yet"}}},n=function(){function t(t,e){void 0===t&&(t=""),void 0===e&&(e=0),this.id=t,this.interval=e||16,this.events={},this.timestamp=0,this.timeline=new Set,this.waitingList=new Set,this.group=[],this.party={},this.precision=17,this.recuperating=0,this.error=0,console.log("%c Q0.0U0.0A0.0N0.0T0.0U0.0M0 - I0.0N0.0C0.0E0.0P0.0T0.0I0.0O0.0N0.0S0-- ","background: rgb(151, 2, 151); color: white; display: block;"),this._quartz()}var n=t.prototype;return n._log=function(t,e){return void 0===e&&(e=!1),e?"!log into something else ":console.log(t)},n._wait=function(t){void 0===t&&(t=null);for(var e=Array.isArray(n=this.waitingList),i=0,n=e?n:n[Symbol.iterator]();;){var a;if(e){if(i>=n.length)break;a=n[i++]}else{if((i=n.next()).done)break;a=i.value}var o=a;this.events[this.party[o].type]?(this.waitingList.delete(o),this._initiate(o)):console.log("@wait list nop")}},n._emitAction=function(t,e,i){void 0===t&&(t=""),void 0===e&&(e={}),void 0===i&&(i={});for(var n=Array.isArray(o=this.events[t]),a=0,o=n?o:o[Symbol.iterator]();;){var r;if(n){if(a>=o.length)break;r=o[a++]}else{if((a=o.next()).done)break;r=a.value}r(e,i)}return{ok:!0,done:!0,data:t+" action emitted"}},n._recuperate=function(t,e){return void 0===t&&(t={}),void 0===e&&(e=0),t.data=t.ok?t.data.sort(function(t,e){return e-t}).reverse():[e],t.data=t.data[0]||t.data[1]||0,t},n._quartz=function(){if(performance.now()-this.timestamp>=this.interval){this.timestamp=performance.now();var t=this.timeline.size?this._processingUnit(this.timeline,this.interval):{ok:!1,data:[]};this.interval=this._recuperate(t,this.interval).data}this.recuperating=requestAnimationFrame(this._quartz.bind(this))},n._processingUnit=function(t,e){var i=this;return new Promise(function(n){for(var a={ok:!0,data:[],id:[]},o=Array.isArray(s=t),r=0,s=o?s:s[Symbol.iterator]();;){var d;if(o){if(r>=s.length)break;d=s[r++]}else{if((r=s.next()).done)break;d=r.value}var l=d;i.party[l].timeout-=e,a.data.push(i.party[l].timeout),a.id.push(l),e>=i.party[l].timeout&&i._sendAction(l),n(a)}})},n._addToTimeline=function(t){return{ok:!0,done:!1,data:this.timeline.add(t)}},n._addToWaitingList=function(t){return this.waitingList.add(t),this.party[t].log&&this._log({ok:!0,done:!1,id:t,data:this.party[t].payload,group:this.party[t].group||0,message:"added to action waiting list"}),{ok:!1,done:!1,data:t+" added to waiting list"}},n._completeAction=function(t){return this.timeline.delete(t),!0},n._repeatAction=function(t){return this.party[t].timeout=this.party[t].interval,--this.party[t].repeat,!1},n._sendAction=function(t){var e={ok:!0,done:this.party[t].repeat>0?this._repeatAction(t):this._completeAction(t),id:t,data:this.party[t].payload,group:this.party[t].group||0};return this.party[t].log&&this._log(e),this._emitAction(this.party[t].type,this.party[t].payload,e)},n._initiate=function(t){return 0===this.party[t].timeout?this._sendAction(t):this._addToTimeline(t)},n._dispatchAction=function(t,e){return this.events[e]?this._initiate(t):this._addToWaitingList(t)},n._createChannel=function(t,i){var n=e[this.party[t.id]?"update":"insert"](t,i);return n.ok?(this.party[t.id]=n.data,this.party[t.id].timeout=this.party[t.id].interval||0,{ok:!0,data:!0}):(console.error("@Cyre : Action could not be created for '"+t.id+"' "+n.message),{ok:!1,data:null,message:n.message})},n.off=function(t){for(var e in this.events)return this.events[e].has(t)?{ok:!0,data:this.events[e].delete(t)}:{ok:!1,data:"Function type not found"}},n.list=function(){for(var t in this.events)for(var e=Array.isArray(n=this.events[t]),i=0,n=e?n:n[Symbol.iterator]();;){var a;if(e){if(i>=n.length)break;a=n[i++]}else{if((i=n.next()).done)break;a=i.value}this._log(a.name)}},n.clr=function(){return this.timeline.clear()},n.pause=function(t){return!!this.timeline.has(t)&&this.timeline.delete(t)},n.on=function(t,e,i){var n=this;return void 0===i&&(i=[]),new Promise(function(i,a){"function"==typeof e?i({ok:!0,data:n.events[t]?n.events[t].add([e]):(n.events[t]=new Set([e]),n._wait(t))}):a({ok:!1,data:"invalid function",message:console.log(t,e)})})},n.type=function(t,e){console.log("cyre.type method not implemented yet in this version, would've update channel.id's type without dispatching the action")},n.channel=function(t){return void 0===t&&(t={}),this.party[t.id]?console.error("@cyre.action: action already exist",t.id):this._createChannel(t,i)},n.action=function(t){return void 0===t&&(t={}),this.party[t.id]?console.error("@cyre.action: action already exist",t.id):this._createChannel(t,i)},n.emit=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=null),this.party[t]?(this.party[t].payload=e,this._dispatchAction(t,this.party[t].type)):console.error("@cyre.call : channel not found",t)},n.call=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this.emit(t,e)},n.dispatch=function(t){return void 0===t&&(t={}),t.id=t.id?t.id:null,!t.type&&console.error("@cyre.dispatch : action type required for - ",t.id),this._createChannel(t,i).ok?{ok:!0,data:this._dispatchAction(t.id,t.type)}:{ok:!1,data:t.id,message:console.log("@Cyre couldn't dispatch action")}},n.respond=function(t,e,n,a,o){void 0===t&&(t=null),void 0===e&&(e=null),void 0===n&&(n=null),void 0===a&&(a=0),void 0===o&&(o=0);var r={id:t,type:e,payload:n,interval:a,repeat:o};return this._createChannel(r,i),this._dispatchAction(r.id,r.type),{ok:!0,data:r.id}},t}(),a=new n("quantum-inceptions");t.cyre=a,t.Cyre=n,t.default=a,Object.defineProperty(t,"__esModule",{value:!0})});

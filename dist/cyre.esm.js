var e=function(){return(e=Object.assign||function(e){for(var n,o=1,a=arguments.length;a>o;o++)for(var t in n=arguments[o])Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e}).apply(this,arguments)};function n(e,n){var o,a,t,r,i={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(r){return function(l){return function(r){if(o)throw new TypeError("Generator is already executing.");for(;i;)try{if(o=1,a&&(t=2&r[0]?a.return:r[0]?a.throw||((t=a.return)&&t.call(a),0):a.next)&&!(t=t.call(a,r[1])).done)return t;switch(a=0,t&&(r=[2&r[0],t.value]),r[0]){case 0:case 1:t=r;break;case 4:return i.label++,{value:r[1],done:!1};case 5:i.label++,a=r[1],r=[0];continue;case 7:r=i.ops.pop(),i.trys.pop();continue;default:if(!(t=(t=i.trys).length>0&&t[t.length-1])&&(6===r[0]||2===r[0])){i=0;continue}if(3===r[0]&&(!t||r[1]>t[0]&&t[3]>r[1])){i.label=r[1];break}if(6===r[0]&&t[1]>i.label){i.label=t[1],t=r;break}if(t&&t[2]>i.label){i.label=t[2],i.ops.push(r);break}t[2]&&i.ops.pop(),i.trys.pop();continue}r=n.call(e,i)}catch(e){r=[6,e],a=0}finally{o=t=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,l])}}}var o=function(n,o){return e({},n,{ok:!0,done:!0})},a=function(n){return n.repeat?e({},n,{timeout:n.interval,ok:!0,done:!1}):e({},n)},t=function(n,o){return o[n.type].forEach(function(e){return e(n.payload,n)}),e({},n,{listeners:o[n.type].size})},r=function(r,i){return l=void 0,u=void 0,d=function(){return n(this,function(n){switch(n.label){case 0:try{r=o(r),r=t(r,i),r=a(r)}catch(e){}return[4,Promise.all([o,t,a])];case 1:return n.sent(),[3,3];case 2:e({},r,{ok:!1,done:!1}),n.label=3;case 3:return[2,r]}})},new((c=void 0)||(c=Promise))(function(e,n){function o(e){try{t(d.next(e))}catch(e){n(e)}}function a(e){try{t(d.throw(e))}catch(e){n(e)}}function t(n){n.done?e(n.value):new c(function(e){e(n.value)}).then(o,a)}t((d=d.apply(l,u||[])).next())});var l,u,c,d},i={insert:function(e,n){var o={};for(var a in e.type=e.type||e.id,e){if(o[a]=n[a]?n[a](e[a]):{ok:!1,payload:null,message:"'"+a+"' data definition not found",required:!1},!o[a].ok&&o[a].required)return console.warn("required :",o),{ok:!1,payload:o,message:o[a].message};o[a].ok||console.error(o[a].message),o[a]=o[a].payload}return{ok:!0,message:"channel created",payload:o}},update:function(e,n){var o={};for(var a in e)o[a]=!!n[a]&&n[a](e[a]),o[a].ok||console.error(o[a].message),o[a]=o[a].data;return{ok:!0,message:"channel updated",payload:o}}},l={id:function(e){return void 0===e&&(e=null),"string"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:null,message:"action.id must be a string. Received '"+e+"'",required:!0}},type:function(e){return void 0===e&&(e=null),"string"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:null,message:"action.type must be a string. Received '"+e+"'",required:!0}},payload:function(e){return void 0===e&&(e=null),{ok:!0,payload:e}},interval:function(e){return void 0===e&&(e=0),Number.isInteger(e)?{ok:!0,payload:e}:{ok:!1,payload:0,message:"'"+e+"' invalid action.interval value",required:!1}},repeat:function(e){return void 0===e&&(e=0),Number.isInteger(e)?{ok:!0,payload:e}:{ok:!1,payload:0,message:"'"+e+"' invalid action.repeat value",required:!1}},message:function(e){return void 0===e&&(e=""),"string"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:"",message:"action.message must be a string. Received '"+e+"'",required:!1}},group:function(e){return void 0===e&&(e=null),"string"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:null,message:"'"+e+"' invalid action.group value",required:!1}},callback:function(e){return void 0===e&&(e=null),"string"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:null,message:"'"+e+"' invalid action.callback value",required:!1}},log:function(e){return void 0===e&&(e=!1),"boolean"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:!1,message:"'"+e+"' invalid action.log value",required:!1}},middleware:function(e){return void 0===e&&(e=null),"string"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:null,message:"'"+e+"' invalid action.middleware value",required:!1}},at:function(e){return void 0===e&&(e=0),{ok:!1,payload:e,message:"'"+e+"'  action.at is an experimental feature, not applied yet",required:!1}}},u=function(e){console.error(e)},c=function(n){var o={},a={},t=function(n){a[n.id]=e({},n)};return{test:function(){return{ok:!0,payload:200,message:"Cyre: Hi there, what can I help you with"}},call:function(n,i){if(void 0===n&&(n=""),void 0===i&&(i=null),!n.trim())return u("@cyre.call : id does not exist "+n),{ok:!1,payload:void 0,message:"@cyre.call : id does not exist"};if(!a[n])return u("@cyre.call: action does not exist "+n),{ok:!1,payload:void 0,message:"@cyre.call : action not found "+n};r(e({},a[n],{payload:i}),o).then(function(n){return t(e({},n,{payload:null}))})},action:function(n){if(!n)return{ok:!1,payload:void 0,message:"@cyre.action: action id is required"};if(a[n.id])return u("@cyre.action: action already exist "+n.id),{ok:!1,payload:n.id,message:"action already exist"};var o=function(n,o){!n.type&&(n.type=n.id);var a=n?"insert":"update",t=i[a](n,o);return t.ok?e({},n,t.payload,{timeout:n.interval||0,ok:!0}):{ok:!1,payload:a,message:t.message}}(n,l);return t(o)},on:function(n,a){var t="function"==typeof a&&""!==n?{ok:!0,payload:o[n]?o[n].add([a]):o[n]=new Set([a])}:{ok:!1,message:"invalid function"};return e({},t,{payload:n})},constructor:function(e,n){console.log("%c Q0.0U0.0A0.0N0.0T0.0U0.0M0 - I0.0N0.0C0.0E0.0P0.0T0.0I0.0O0.0N0.0S0-- ","background: rgb(151, 2, 151); color: white; display: block;")}}},d=c();export default d;export{c as Cyre,d as cyre};

"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var __assign=function(){return(__assign=Object.assign||function(e){for(var n,t=1,o=arguments.length;o>t;t++)for(var a in n=arguments[t])Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a]);return e}).apply(this,arguments)};function __awaiter(e,n,t,o){return new(t||(t=Promise))(function(a,r){function i(e){try{u(o.next(e))}catch(e){r(e)}}function l(e){try{u(o.throw(e))}catch(e){r(e)}}function u(e){e.done?a(e.value):new t(function(n){n(e.value)}).then(i,l)}u((o=o.apply(e,n||[])).next())})}function __generator(e,n){var t,o,a,r,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(r){return function(l){return function(r){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,o&&(a=2&r[0]?o.return:r[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,r[1])).done)return a;switch(o=0,a&&(r=[2&r[0],a.value]),r[0]){case 0:case 1:a=r;break;case 4:return i.label++,{value:r[1],done:!1};case 5:i.label++,o=r[1],r=[0];continue;case 7:r=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){i=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&a[3]>r[1])){i.label=r[1];break}if(6===r[0]&&a[1]>i.label){i.label=a[1],a=r;break}if(a&&a[2]>i.label){i.label=a[2],i.ops.push(r);break}a[2]&&i.ops.pop(),i.trys.pop();continue}r=n.call(e,i)}catch(e){r=[6,e],o=0}finally{t=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,l])}}}var _this=void 0,_prepareActionToEmit=function(e,n){return __assign({},e,{ok:!0,done:!0})},_repeatAction=function(e){return e.repeat?__assign({},e,{timeout:e.interval,ok:!0,done:!1}):__assign({},e)},_emitAction=function(e,n){return n[e.type].forEach(function(n){return n(e.payload,e)}),__assign({},e,{listeners:n[e.type].size})},_initiateAction=function(e,n){return!!n[e.type]},Action=function(e,n){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:try{e=_prepareActionToEmit(e,n),e=_emitAction(e,n),e=_repeatAction(e)}catch(e){}return _initiateAction?[4,Promise.all([_prepareActionToEmit,_emitAction,_repeatAction])]:[3,2];case 1:return t.sent(),[3,3];case 2:__assign({},e,{ok:!1,done:!1}),t.label=3;case 3:return[2,e]}})})},middleware={insert:function(e,n){var t={};for(var o in e.type=e.type||e.id,e){if(t[o]=n[o]?n[o](e[o]):{ok:!1,payload:null,message:"'"+o+"' data definition not found",required:!1},!t[o].ok&&t[o].required)return console.warn("required :",t),{ok:!1,payload:t,message:t[o].message};t[o].ok||console.error(t[o].message),t[o]=t[o].payload}return{ok:!0,message:"channel created",payload:t}},update:function(e,n){var t={};for(var o in e)t[o]=!!n[o]&&n[o](e[o]),t[o].ok||console.error(t[o].message),t[o]=t[o].data;return{ok:!0,message:"channel updated",payload:t}}},createChannel=function(e,n){!e.type&&(e.type=e.id);var t=e?"insert":"update",o=middleware[t](e,n);return o.ok?__assign({},e,o.payload,{timeout:e.interval||0,ok:!0}):{ok:!1,payload:t,message:o.message}},dataDefinitions={id:function(e){return void 0===e&&(e=null),"string"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:null,message:"action.id must be a string. Received '"+e+"'",required:!0}},type:function(e){return void 0===e&&(e=null),"string"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:null,message:"action.type must be a string. Received '"+e+"'",required:!0}},payload:function(e){return void 0===e&&(e=null),{ok:!0,payload:e}},interval:function(e){return void 0===e&&(e=0),Number.isInteger(e)?{ok:!0,payload:e}:{ok:!1,payload:0,message:"'"+e+"' invalid action.interval value",required:!1}},repeat:function(e){return void 0===e&&(e=0),Number.isInteger(e)?{ok:!0,payload:e}:{ok:!1,payload:0,message:"'"+e+"' invalid action.repeat value",required:!1}},message:function(e){return void 0===e&&(e=""),"string"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:"",message:"action.message must be a string. Received '"+e+"'",required:!1}},group:function(e){return void 0===e&&(e=null),"string"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:null,message:"'"+e+"' invalid action.group value",required:!1}},callback:function(e){return void 0===e&&(e=null),"string"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:null,message:"'"+e+"' invalid action.callback value",required:!1}},log:function(e){return void 0===e&&(e=!1),"boolean"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:!1,message:"'"+e+"' invalid action.log value",required:!1}},middleware:function(e){return void 0===e&&(e=null),"string"==typeof e?{ok:!0,payload:e}:{ok:!1,payload:null,message:"'"+e+"' invalid action.middleware value",required:!1}},at:function(e){return void 0===e&&(e=0),{ok:!1,payload:e,message:"'"+e+"'  action.at is an experimental feature, not applied yet",required:!1}}},error=function(e){console.error(e)},Cyre=function(e){var n={},t={},o=function(e){t[e.id]=__assign({},e)};return{test:function(){return{ok:!0,payload:200,message:"Cyre: Hi there, what can I help you with"}},call:function(e,a){if(void 0===e&&(e=""),void 0===a&&(a=null),!e.trim())return error("@cyre.call : id does not exist "+e),{ok:!1,payload:void 0,message:"@cyre.call : id does not exist"};if(!t[e])return error("@cyre.call: action does not exist "+e),{ok:!1,payload:void 0,message:"@cyre.call : action not found "+e};Action(__assign({},t[e],{payload:a}),n).then(function(e){return o(__assign({},e,{payload:null}))})},action:function(e){if(!e)return{ok:!1,payload:void 0,message:"@cyre.action: action id is required"};if(t[e.id])return error("@cyre.action: action already exist "+e.id),{ok:!1,payload:e.id,message:"action already exist"};var n=createChannel(e,dataDefinitions);return o(n)},on:function(e,t){var o="function"==typeof t&&""!==e?{ok:!0,payload:n[e]?n[e].add([t]):n[e]=new Set([t])}:{ok:!1,message:"invalid function"};return __assign({},o,{payload:e})},constructor:function(e,n){console.log("%c Q0.0U0.0A0.0N0.0T0.0U0.0M0 - I0.0N0.0C0.0E0.0P0.0T0.0I0.0O0.0N0.0S0-- ","background: rgb(151, 2, 151); color: white; display: block;")}}},cyre=Cyre();exports.Cyre=Cyre,exports.cyre=cyre,exports.default=cyre;
